[
["index.html", "Föll í R - Dæmi 1 Inngangur 1.1 Pakkar 1.2 Gagnasett 1.3 Fallegar töflur", " Föll í R - Dæmi Eyþór Björnsson 2017-05-13 1 Inngangur Hér eru dæmi um notkun á föllum og skriftum í R sem ég hef búið til. Þau má finna á GitHub. Þetta skjal er búið til með bookdown. Það er frábær pakki sem tvinnar saman R markdown skrár og setur saman í aðgengilegt html-bókarsnið. 1.1 Pakkar library(dplyr); library(knitr); library(kableExtra) options(knitr.table.format = &quot;html&quot;) 1.2 Gagnasett Í öllum dæmunum er notast við ‘diabetes’ gagnasettið sem er aðgengilegt frá http://biostat.mc.vanderbilt.edu/wiki/Main/DataSets. The data consist of 19 variables on 403 subjects from 1046 subjects who were interviewed in a study to understand the prevalence of obesity, diabetes, and other cardiovascular risk factors in central Virginia for African Americans. According to Dr John Hong, Diabetes Mellitus Type II (adult onset diabetes) is associated most strongly with obesity. The waist/hip ratio may be a predictor in diabetes and heart disease. DM II is also agssociated with hypertension - they may both be part of “Syndrome X”. The 403 subjects were the ones who were actually screened for diabetes. Glycosolated hemoglobin &gt; 7.0 is usually taken as a positive diagnosis of diabetes. data &lt;- read.csv(&quot;diabetes.csv&quot;, header=TRUE) data$dm &lt;- ifelse(data$glyhb &gt; 7.0, 1, 0) # Skilgreinir sykursjúka data$male &lt;- ifelse(data$gender==&quot;male&quot;, 1, 0) str(data) ## &#39;data.frame&#39;: 403 obs. of 21 variables: ## $ id : int 1000 1001 1002 1003 1005 1008 1011 1015 1016 1022 ... ## $ chol : int 203 165 228 78 249 248 195 227 177 263 ... ## $ stab.glu: int 82 97 92 93 90 94 92 75 87 89 ... ## $ hdl : int 56 24 37 12 28 69 41 44 49 40 ... ## $ ratio : num 3.6 6.9 6.2 6.5 8.9 ... ## $ glyhb : num 4.31 4.44 4.64 4.63 7.72 ... ## $ location: Factor w/ 2 levels &quot;Buckingham&quot;,&quot;Louisa&quot;: 1 1 1 1 1 1 1 1 1 1 ... ## $ age : int 46 29 58 67 64 34 30 37 45 55 ... ## $ gender : Factor w/ 2 levels &quot;female&quot;,&quot;male&quot;: 1 1 1 2 2 2 2 2 2 1 ... ## $ height : int 62 64 61 67 68 71 69 59 69 63 ... ## $ weight : int 121 218 256 119 183 190 191 170 166 202 ... ## $ frame : Factor w/ 3 levels &quot;large&quot;,&quot;medium&quot;,..: 2 1 1 1 2 1 2 2 1 3 ... ## $ bp.1s : int 118 112 190 110 138 132 161 NA 160 108 ... ## $ bp.1d : int 59 68 92 50 80 86 112 NA 80 72 ... ## $ bp.2s : int NA NA 185 NA NA NA 161 NA 128 NA ... ## $ bp.2d : int NA NA 92 NA NA NA 112 NA 86 NA ... ## $ waist : int 29 46 49 33 44 36 46 34 34 45 ... ## $ hip : int 38 48 57 38 41 42 49 39 40 50 ... ## $ time.ppn: int 720 360 180 480 300 195 720 1020 300 240 ... ## $ dm : num 0 0 0 0 1 0 0 0 0 0 ... ## $ male : num 0 0 0 1 1 1 1 1 1 0 ... 1.3 Fallegar töflur Til þess að búa til aðlaðandi html töflur eru hráar töflur settar í pípu til knitr::kable. Einnig nota ég valdar skipanir úr kableExtra eins og kable_styling(full_width = F) til þess að hindra það að lítil tafla sé teygð þvert yfir síðuna, og add_header_above() til þess að bæta við dálkaheiti ofan við önnur dálkaheiti. "],
["quantile-analysis.html", "2 quantile_analysis 2.1 Lýsing 2.2 Breytur 2.3 Skilgreining 2.4 Dæmi 1 2.5 Dæmi 2 2.6 Dæmi 3", " 2 quantile_analysis 2.1 Lýsing quantile_analysis er fall sem skiptir í jafna hópa eftir raðaðri breytu (e. quantiles: s.s. þriðjunga, fjórðunga, fimmtunga o.s.frv) og skilar töflu fyrir tengsl þeirra við svarbreytu. Það höndlar samfelldar og tvíkosta svarbreytur og mögulegt er að leiðrétta fyrir öðrum skýribreytum. Fyrir samfelldar svarbreytur er lm notað og fyrir tvíkosta breytur hefðbundið tvíkosta aðhvarf með glm með family=binomial. Við samanburð á hópum er alltaf miðað við neðsta hópinn (t.d. neðsta fimmtung) og því skilgreindur undirhópur fyrir hvert aðhvarfslíkan: subset = quantile %in% c(1,i), þar sem i er hópurinn sem bera á saman við hóp eitt. 95% öryggisbil eru reiknuð með confint skipuninni. 2.2 Breytur Fallið tekur eftirfarandi breytur: variable: breytan sem liggur til grundvallar við skiptingu í hópa (quantiles). n_quantiles: fjöldi hópa. method: Aðferðin til þess að skipta í hópa út frá röðuðum gögnum. cut2 er sjálfgefið, vísar til Hmisc::cut2 sem skiptir í nokkurn veginn jafna hópa (fjöldi tilgreindur með g=), þannig að engin gildi koma fyrir í fleiri en einum hóp. Hægt er að velja ntile sem vísar til dplyr::ntile sem skiptir í jafna hópa en leyfir það að sömu gildi geta komið fyrir í aðlægum hópum., ólíkt cut2. outcome: svarbreytan. Getur verið samfelld eða tvíkosta. model_type: linear fyrir samfellda svarbreytu en logistic fyrir tvíkosta svarbreytu. covariates: vigri með skýribreytum til þess að leiðrétta fyrir í fjölbreytulíkani. Má sleppa til þess að fá einbreytulíkan. data ATH Fallið notar pakkana Hmisc og dplyr. 2.3 Skilgreining source(&quot;functions/function_quantile_analysis.R&quot;) 2.4 Dæmi 1 Skiptum kviðarummáli í fimmtunga og skoðum tengsl þeirra við sykursýki. Ekki er leiðrétt fyrir öðrum breytum. quantile_analysis(variable = &quot;waist&quot;, n_quantiles = 5, outcome = &quot;dm&quot;, model_type = &quot;logistic&quot;, data = data) %&gt;% kable(align = &#39;c&#39;, caption = &quot;Unadjusted association of waist circumference quintiles with diabetes mellitus&quot;) %&gt;% add_header_above(c(&quot; &quot;=2, &quot;Diabetes mellitus&quot; = 5)) Table 2.1: Unadjusted association of waist circumference quintiles with diabetes mellitus Diabetes mellitus Quantile N Prop. Unadj. OR CI_lw CI_hi P 1 102 4.0 ref 2 68 17.9 5.182 1.712 19.251 0.0063 3 86 13.6 3.732 1.22 13.912 0.029 4 78 20.0 5.937 2.044 21.593 0.0024 5 67 27.3 8.906 3.121 32.146 0.00016 Dálkarnir í töflunni að ofan (frá vinstri til hægri) sýna fimmtunga (fyrsti hefur minnst kviðarummál), fjölda í hverjum fimmtungi, hlutfall (pósentur) með sykursýki í hverjum fimmtungi, OR reiknað miðað við fyrsta fimmtung (merktur með “ref”, reference), svo neðri og efri mörk 95% öryggisbils fyrir OR og loks p-gildi. Skoðum betur hvernig fimmtungar voru skilgreindir í fallinu með cut2, hér frá grunni þar sem fallið býr aðeins til fimmtungana tímabundið og breytir ekki upphaflegu gagnasettinu. data %&gt;% mutate(quantile = as.numeric(cut2(waist, g=5))) %&gt;% group_by(quantile) %&gt;% summarise(n(), mean(waist), min(waist), max(waist)) %&gt;% kable quantile n() mean(waist) min(waist) max(waist) 1 102 31.09804 26 33 2 68 35.02941 34 36 3 86 37.88372 37 39 4 78 41.25641 40 43 5 67 47.28358 44 56 NA 2 NA NA NA 2.5 Dæmi 2 Skoðum nú þriðjunga kviðarummáls og tengsl við sykursýki, en leiðréttum fyrir aldri og kyni. quantile_analysis(variable = &quot;waist&quot;, n_quantiles = 3, outcome = &quot;dm&quot;, model_type = &quot;logistic&quot;, covariates = c(&quot;age&quot;, &quot;gender&quot;), data = data) %&gt;% kable(align = &#39;c&#39;, caption = &quot;Association of waist circumference tertiles with diabetes mellitus, adjusted for age and sex&quot;) %&gt;% add_header_above(c(&quot; &quot;=2, &quot;Diabetes mellitus&quot; = 5)) Table 2.2: Association of waist circumference tertiles with diabetes mellitus, adjusted for age and sex Diabetes mellitus Quantile N Prop. Adj. OR CI_lw CI_hi P 1 145 7.8 ref 2 139 14.3 1.667 0.741 3.911 0.22 3 117 26.3 3.505 1.65 7.9 0.0016 2.6 Dæmi 3 Skoðum HDL-kólesteról eftir þriðjungum sykraðs hemóglóbíns. ATH þetta er samfelld breyta svo í samanburði milli fjórðunga fáum við beinan mismun í óleiðréttu líkani. quantile_analysis(variable = &quot;glyhb&quot;, n_quantiles = 4, outcome = &quot;hdl&quot;, model_type = &quot;linear&quot;, data = data) %&gt;% kable(align = &#39;c&#39;, caption = &quot;Unadjusted association of HbA1c quartiles with HDL-cholesterol&quot;) %&gt;% add_header_above(c(&quot; &quot;=2, &quot;HDL-cholesterol&quot; = 5)) Table 2.3: Unadjusted association of HbA1c quartiles with HDL-cholesterol HDL-cholesterol Quantile N Mean Unadj. difference CI_lw CI_hi P 1 99 53.041 ref 2 98 52.276 -0.765 -5.606 4.076 0.76 3 96 49.917 -3.124 -7.958 1.71 0.2 4 97 45.784 -7.257 -12.097 -2.417 0.0035 "],
["regression-table.html", "3 regression_table 3.1 Lýsing 3.2 Breytur 3.3 Skilgreining 3.4 Dæmi 1 3.5 Dæmi 2 3.6 Dæmi 3", " 3 regression_table 3.1 Lýsing Með regression_table er einfalt og fljótlegt að búa til stíhreina töflu fyrir niðurstöður úr línulegu eða tvíkosta (logistic) aðhvarfi. Hægt er að skilgreina eitt fjölþátta líkan og birta niðurstöður fyrir allar skýribreyturnar í því líkani, sem er áþekkt summary(lm(...)). Einnig er hægt að keyra lista af skýribreytum gegnum líkanið og birta niðurstöður fyrir hverja þeirra í einni og sömu töflunni. 95% öryggisbil eru reiknuð með confint skipuninni. 3.2 Breytur Fallið tekur breytunar: variables: vigri með einni eða fleiri skýribreytum sem við höfum áhuga á. Ef ein breyta er tilgreind eru birtar niðurstöður fyrir þá breytu ásamt öðrum skýribreytum í líkaninu (tilgreindar í covariates), t.d. eitt fjölþátta líkan. Ef fleiri breytur eru tilgreindar eru birtar niðurstöður fyrir hverja og eina þeirra, þar sem leiðrétt er fyrir breytunum í covariates. outcome: svarbreytan í líkaninu. covariates: vigri með skýribreytum til þess að leiðrétta fyrir. Sleppa má covariates til þess að fá óleiðréttar niðurstöður. model_type: Tekur gildið linear fyrir línulegt aðhvarf (notar lm) og logistic við tvíkosta aðhvarf (notar glm með family = binomial). data 3.3 Skilgreining source(&quot;functions/function_regression_table.R&quot;) 3.4 Dæmi 1 Óleiðrétt fylgni kviðarummáls við sykursýki, tvíkosta aðhvarf. regression_table(variables = &quot;waist&quot;, outcome = &quot;dm==1&quot;, model_type = &quot;logistic&quot;, data = data) %&gt;% kable(align=&#39;c&#39;, caption = &quot;Unadjusted model&quot;) %&gt;% kable_styling(full_width = F) %&gt;% add_header_above(c(&quot; &quot; = 2, &quot;Diabetes mellitus&quot; = 3)) Table 3.1: Unadjusted model Diabetes mellitus Predictors N OR 95% CI P waist 388 1.109 1.058, 1.164 2.4e-05 Sjáum líka óleiðrétta fylgni fyrir aldur og hdl. regression_table(variables = c(&quot;waist&quot;, &quot;age&quot;, &quot;hdl&quot;), outcome = &quot;dm==1&quot;, model_type = &quot;logistic&quot;, data = data) %&gt;% kable(align=&#39;c&#39;, caption = &quot;Unadjusted models&quot;) %&gt;% kable_styling(full_width = F) %&gt;% add_header_above(c(&quot; &quot; = 2, &quot;Diabetes mellitus&quot; = 3)) Table 3.2: Unadjusted models Diabetes mellitus Predictors N OR 95% CI P waist 388 1.109 1.058, 1.164 2.4e-05 age 390 1.054 1.035, 1.074 2.3e-08 hdl 389 0.977 0.957, 0.995 0.016 3.5 Dæmi 2 Fyglni kviðarummáls við sykrað hemóglóbín, leiðrétt fyrir aldri og kyni. Þar sem aðeins ein breyta er tilgreind í variables skilar fallið niðurstöðum fyrir allar breytur í líkaninu, svipað og summary(lm(...)). regression_table(variables = &quot;waist&quot;, outcome = &quot;glyhb&quot;, covariates = c(&quot;age&quot;, &quot;gender&quot;), model_type = &quot;linear&quot;, data = data) %&gt;% kable(align=&#39;c&#39;, caption = &quot;Multivariate model&quot;) %&gt;% kable_styling(full_width = F) %&gt;% add_header_above(c(&quot; &quot; = 2, &quot;HbA1c (%)&quot; = 3)) Table 3.3: Multivariate model HbA1c (%) Predictors N beta 95% CI P waist 388 0.071 0.034, 0.107 0.00016 age 388 0.042 0.029, 0.055 4e-10 gendermale 388 0.150 -0.274, 0.573 0.49 Ef við tilgreinum fleiri breytur í variables fáum við fylgni fyrir hverja og eina þeirra við sykrað hemógóbín, þar sem leiðrétt fyrir aldri og kyni hverju sinni. regression_table(variables = c(&quot;waist&quot;, &quot;chol&quot;, &quot;hdl&quot;, &quot;weight&quot;), outcome = &quot;glyhb&quot;, covariates = c(&quot;age&quot;, &quot;gender&quot;), model_type = &quot;linear&quot;, data = data) %&gt;% kable(align=&#39;c&#39;, caption = &quot;Each model adjusted for age and sex&quot;) %&gt;% kable_styling(full_width = F) %&gt;% add_header_above(c(&quot; &quot; = 2, &quot;HbA1c (%)&quot; = 3)) Table 3.4: Each model adjusted for age and sex HbA1c (%) Predictors N beta 95% CI P waist 388 0.071 0.034, 0.107 0.00016 chol 389 0.009 0.004, 0.014 0.00036 hdl 389 -0.021 -0.033, -0.008 0.00097 weight 389 0.011 0.005, 0.016 5.5e-05 3.6 Dæmi 3 Hægt er að skilgreina breyturnar á sama hátt og þegar unnið er með lm og glm. T.d. má staðla breytu með scale() (þar sem einingin jafngildir einu staðalfráviki) eða umbreyta samfelldri breytu í tvíkosta breytu með því að tilgreina þröskuld. regression_table(variables = c(&quot;scale(waist)&quot;, &quot;(chol&gt;250)&quot;, &quot;(hdl&lt;30)&quot;, &quot;weight&quot;), outcome = &quot;(glyhb&gt;7.5)&quot;, covariates = c(&quot;age&quot;, &quot;gender&quot;), model_type = &quot;logistic&quot;, data = data) %&gt;% kable(align=&#39;c&#39;, caption = &quot;Each model adjusted for age and sex&quot;) %&gt;% kable_styling(full_width = F) %&gt;% add_header_above(c(&quot; &quot; = 2, &quot;HbA1c &gt; 7.5%&quot; = 3)) Table 3.5: Each model adjusted for age and sex HbA1c &gt; 7.5% Predictors N OR 95% CI P scale(waist) 388 1.679 1.242, 2.287 0.00084 (chol&gt;250) 389 1.973 0.944, 3.975 0.062 (hdl&lt;30) 389 3.753 1.341, 10.066 0.0092 weight 389 1.014 1.006, 1.022 0.00043 "],
["table-one.html", "4 table_one 4.1 Lýsing 4.2 Breytur 4.3 Skilgreining 4.4 Dæmi 1 4.5 Dæmi 2 4.6 Dæmi 3", " 4 table_one 4.1 Lýsing table_one er fall sem skilar töflu þar sem valdar breytur eru bornar saman eftir gildum ákveðinnar breytu. Fyrir samfelldar breytur fáum við meðaltöl og staðalfrávik, fyrir tvíkosta breytur eru gefnar prósentur (hlutfall gilda sem eru ‘1’). Þetta er dæmigerð ‘tafla eitt’ í vísindagrein. 4.2 Breytur Fallið tekur eftirfarandi breytur: data var_cont: vigur með heitum á samfelldum breytum. var_bin: vigur með heitum á tvíkosta breytum (þurfa að taka gildin 0 eða 1). comparing: heiti flokkabreytu sem skilgreinir dálka í töflunni. Getur tekið tvö eða fleiri gildi. 4.3 Skilgreining source(&quot;functions/function_table_one.R&quot;) 4.4 Dæmi 1 var_cont &lt;- c(&quot;age&quot;, &quot;weight&quot;, &quot;waist&quot;, &quot;chol&quot;, &quot;stab.glu&quot;, &quot;hdl&quot;, &quot;ratio&quot;, &quot;bp.1s&quot;) var_bin &lt;- c(&quot;male&quot;) comparing &lt;- &quot;dm&quot; table_one(data = data, var_cont = var_cont, var_bin = var_bin, comparing = comparing) %&gt;% kable(align = &#39;c&#39;, caption = &quot;Patient characteristics&quot;) %&gt;% add_header_above(c(&quot; &quot; = 2, &quot;Diabetes mellitus&quot; = 2)) Table 4.1: Patient characteristics Diabetes mellitus Variable Statistic 0 1 n 330 60 age Mean (SD) 44.66 (16.11) 58.4 (13.12) weight Mean (SD) 174.6 (39.84) 192.71 (40.68) waist Mean (SD) 37.35 (5.6) 40.88 (5.75) chol Mean (SD) 203.39 (41.14) 228.6 (56.53) stab.glu Mean (SD) 91.55 (26.87) 194.17 (77.44) hdl Mean (SD) 51.18 (17.25) 45.28 (16.85) ratio Mean (SD) 4.32 (1.44) 5.63 (2.63) bp.1s Mean (SD) 135.19 (22.93) 147.77 (20.5) male Percentage 41.21 43.33 4.5 Dæmi 2 Flokkað eftir breytu með þrjú möguleg gildi. var_cont &lt;- c(&quot;age&quot;, &quot;weight&quot;, &quot;waist&quot;, &quot;chol&quot;, &quot;stab.glu&quot;, &quot;hdl&quot;, &quot;ratio&quot;, &quot;bp.1s&quot;) var_bin &lt;- c(&quot;male&quot;, &quot;dm&quot;) comparing &lt;- &quot;frame&quot; table_one(data = data, var_cont = var_cont, var_bin = var_bin, comparing = comparing) %&gt;% kable(align = &#39;c&#39;, caption = &quot;Patient characteristics&quot;) %&gt;% add_header_above(c(&quot; &quot; = 2, &quot;Frame&quot; = 3)) Table 4.2: Patient characteristics Frame Variable Statistic large medium small n 103 184 104 age Mean (SD) 52.84 (15.77) 45.71 (15.39) 42.21 (15.54) weight Mean (SD) 203.81 (43.19) 178.31 (33.85) 150.96 (29.99) waist Mean (SD) 41.82 (5.53) 37.89 (4.98) 34.05 (4.62) chol Mean (SD) 208 (43.25) 213.54 (45.76) 197.5 (39.13) stab.glu Mean (SD) 121.2 (63.68) 104.29 (49.88) 95.97 (44.38) hdl Mean (SD) 44.6 (13.36) 50.8 (17.44) 55.54 (17.72) ratio Mean (SD) 4.99 (1.5) 4.64 (1.95) 3.85 (1.27) bp.1s Mean (SD) 141.18 (19.81) 137.76 (24.27) 130.03 (21.16) male Percentage 59.22 36.96 33.65 dm Percentage 23.23 14.61 8.82 4.6 Dæmi 3 Engar flokkabreytur. var_cont &lt;- c(&quot;age&quot;, &quot;weight&quot;, &quot;waist&quot;) comparing &lt;- &quot;frame&quot; table_one(data = data, var_cont = var_cont, comparing = comparing) %&gt;% kable(align = &#39;c&#39;, caption = &quot;Patient characteristics&quot;) %&gt;% add_header_above(c(&quot; &quot; = 2, &quot;Frame&quot; = 3)) Table 4.3: Patient characteristics Frame Variable Statistic large medium small n 103 184 104 age Mean (SD) 52.84 (15.77) 45.71 (15.39) 42.21 (15.54) weight Mean (SD) 203.81 (43.19) 178.31 (33.85) 150.96 (29.99) waist Mean (SD) 41.82 (5.53) 37.89 (4.98) 34.05 (4.62) "]
]
